(this.webpackJsonpgenomegraph=this.webpackJsonpgenomegraph||[]).push([[0],{64:function(e,t,a){e.exports=a(78)},69:function(e,t,a){},77:function(e,t,a){},78:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(19),o=a.n(c),l=(a(69),a(15)),i=a.n(l),u=a(38),s=a(7),m=a(84),h=a(57);function d(e){var t=e.data,a=e.onHide;return r.a.createElement(m.a,{show:!0,onHide:a},r.a.createElement(m.a.Header,{closeButton:!0},r.a.createElement(m.a.Title,null,"Feature details")),r.a.createElement(m.a.Body,null,r.a.createElement("div",null,"Attributes"),Object.entries(t).filter((function(e){return!["source","target","linkNum","tags"].includes(e[0])})).map((function(e){var t=Object(s.a)(e,2),a=t[0],n=t[1];return r.a.createElement("div",{key:"".concat(a,"_").concat(n),style:{display:"flex",maxHeight:150,margin:3}},r.a.createElement("div",{style:{backgroundColor:"#dda",minWidth:100}},a),r.a.createElement("div",{style:{wordBreak:"break-word",overflow:"auto"}},String(n)))})),r.a.createElement("hr",null),t.tags&&Object.keys(t.tags).length?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,"Tags"),Object.entries(t.tags).map((function(e){var t=Object(s.a)(e,2),a=t[0],n=t[1];return r.a.createElement("div",{key:"".concat(a,"_").concat(n),style:{display:"flex",maxHeight:150,margin:3}},r.a.createElement("div",{style:{backgroundColor:"#dda",minWidth:100}},a),r.a.createElement("div",{style:{wordBreak:"break-word",overflow:"auto"}},String(n)))}))):null,r.a.createElement(m.a.Footer,null,r.a.createElement(h.a,{variant:"secondary",onClick:a},"Close"))))}var f=a(53),g=a(26),p=a(51),b=a(10),E=i.a.mark(k),v=i.a.mark(w);function k(e,t){var a,n,r,c,o;return i.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:a=e[0].linkNum,n=[],c=0;case 3:if(!(c<e.length)){l.next=17;break}if(o=e[c],a===o.linkNum){l.next=11;break}if(!r.id){l.next=9;break}return l.next=9,{links:n,original:r};case 9:n=[],a=o.linkNum;case 11:r=t[c],n.push([o.source.x,o.source.y]),n.push([o.target.x,o.target.y]);case 14:c++,l.next=3;break;case 17:case"end":return l.stop()}}),E)}function w(e,t){var a,n,r;return i.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:a=0;case 1:if(!(a<e.length)){c.next=10;break}if(n=e[a],(r=t[a]).id){c.next=7;break}return c.next=7,{links:[[n.source.x,n.source.y],[n.target.x,n.target.y]],original:r};case 7:a++,c.next=1;break;case 10:case"end":return c.stop()}}),v)}var O=r.a.forwardRef((function(e,t){var a=Object(n.useRef)(),c=e.graph,o=e.drawPaths,l=void 0!==o&&o,i=e.settings,u=e.color,s=void 0===u?"Rainbow":u,m=e.width,h=void 0===m?2e3:m,d=e.height,E=void 0===d?1e3:d,v=e.onFeatureClick,O=void 0===v?function(){console.log("no feature click configured")}:v,j=i.chunkSize,y=void 0===j?1e3:j,x=i.numSteps,S=void 0===x?500:x,C=i.sequenceThickness,T=void 0===C?10:C,H=i.linkThickness,B=void 0===H?2:H,M=i.strength,G=void 0===M?-50:M;console.log(y,S,G);var N=Object(n.useMemo)((function(){return function(e,t){for(var a={nodes:[],links:[]},n={},r=0;r<(e.paths||{}).length;r++)for(var c=e.paths[r],o=c.path.split(","),l=0;l<o.length-1;l++){var i="".concat(o[l],"_").concat(o[l+1]);n[i]?n[i].push(c.name):n[i]=[c.name]}for(var u=0;u<e.nodes.length;u++){var s=e.nodes[u],m=s.id,h=s.sequence,d=Object(p.a)(s,["id","sequence"]),f=[],b="*"===h?d.tags.LN:h.length;f.push(Object(g.a)({},d,{id:"".concat(m,"-start")}));for(var E=t;E<b-t;E+=t)f.push(Object(g.a)({},d,{id:"".concat(m,"-").concat(E)}));f.push(Object(g.a)({},d,{id:"".concat(m,"-end")}));for(var v=0;v<f.length-1;v++){var k=f[v].id,w=f[v+1].id;a.links.push(Object(g.a)({},d,{source:k,target:w,id:m,length:b,sequence:h,linkNum:u}))}a.nodes=a.nodes.concat(f)}for(var O=0;O<e.links.length;O++){var j=e.links[O],y=j.strand1,x=j.strand2,S=j.source,C=j.target,T=Object(p.a)(j,["strand1","strand2","source","target"]),H=n["".concat(S).concat(y,"_").concat(C).concat(x)]||[],B=S===C,M=Object(g.a)({source:"".concat(S,"-").concat("+"===y?"end":"start"),target:"".concat(C,"-").concat("+"===x?"start":"end")},T);B&&(M.loop=!0),H.length&&(M.paths=H),a.links.push(M)}return a}(c,y)}),[y,c]),L=Object(n.useMemo)((function(){var e={};return(c.paths||[]).forEach((function(t,a){e[t.name]=b.schemeCategory10[a]})),e}),[c.paths]),q=Object(n.useMemo)((function(){for(var e=N.links.map((function(e){return Object.create(e)})),t=N.nodes.map((function(e){return Object.create(e)})),a=0,n=0;n<N.links.length;n++)a=Math.max(a,(N.links[n].sequence||{}).length||0);for(var r=b.forceSimulation(t).force("link",b.forceLink(e).id((function(e){return e.id})).distance((function(e){return e.sequence?1:10}))).force("charge",b.forceManyBody().strength(G)).force("center",b.forceCenter(h/2,E/2)),c=0;c<S;++c)r.tick();return e}),[N.links,N.nodes,E,S,G,h]);Object(n.useEffect)((function(){b.select(t.current).call(b.zoom().extent([[0,0],[h,E]]).scaleExtent([.1,8]).on("zoom",(function(){b.select(a.current).attr("transform",b.event.transform)})))}),[E,t,h]);var W=Object(f.a)(k(q,N.links)),F=Object(f.a)(w(q,N.links)),z={};return W.forEach((function(e){var t=e.original,a=t.source,n=t.target,r=t.linkNum;a.endsWith("start")?(z[a]={source:q[r].target,target:q[r].source},z[n]={target:q[r].target,source:q[r].source}):(z[a]={source:q[r].source,target:q[r].target},z[n]={target:q[r].source,source:q[r].target})})),l&&!F[0].original.paths?r.a.createElement("h1",null,"no paths found"):r.a.createElement("svg",{width:"100%",height:"100%",ref:t,viewBox:[0,0,h,E].toString()},r.a.createElement("g",{ref:a},F.map((function(e){var t=e.links[0][0],a=e.links[0][1],n=e.links[1][0],c=e.links[1][1];if(l){var o=z[e.original.source],i=o.source,u=o.target,s=z[e.original.target],m=s.source,h=s.target,d=Math.sqrt(Math.pow(u.y-i.y,2)+Math.pow(u.x-i.x,2)),f=Math.sqrt(Math.pow(h.y-m.y,2)+Math.pow(h.x-m.x,2));return e.original.paths.map((function(o,l){var s=(60+50*l)/d,g=(60+50*l)/f,p=(1-s)*i.x+s*u.x,E=(1-s)*i.y+s*u.y,v=(1-g)*m.x+g*h.x,k=(1-g)*m.y+g*h.y,w=b.path();return w.moveTo(t,a),w.bezierCurveTo(p,E,v,k,n,c),r.a.createElement("path",{key:w.toString(),d:w,strokeWidth:B,stroke:L[o],fill:"none",onClick:function(){return O(e.original)}})}))}var g,p=b.line().context(null),E=e.links[0][0],v=e.links[0][1],k=e.links[1][0],w=e.links[1][1],j=k-E,y=w-v,x=Math.sqrt(j*j+y*y),S=x,C=x,T=0,H=0;return e.original.loop?(T=90,H=1,S=-30,C=-20,k+=1,w+=1,g="M".concat(E,",").concat(v,"A").concat(S,",").concat(C," ").concat(T,",").concat(H,",").concat(0," ").concat(k,",").concat(w)):g=p(e.links),r.a.createElement("path",{key:g.toString(),d:g,strokeWidth:B,stroke:"black",fill:"none",onClick:function(){return O(e.original)}})})),W.map((function(e,t){var a=b.line().context(null)(e.links);return r.a.createElement("path",{key:a.toString(),d:a,title:e.id,strokeWidth:T,stroke:s.startsWith("Just")?s.replace("Just","").toLowerCase():b.hsl(b["interpolate".concat(s)](t/W.length)).darker(),fill:"none",onClick:function(){return O(e.original)}},r.a.createElement("title",null,e.id))}))))})),j=a(85),y=a(50),x=a(52);var S=a(58),C=a.n(S),T=r.a.forwardRef((function(e,t){var a=e.onColorChange,n=e.onPathDraw,c=e.color;return r.a.createElement("div",null,r.a.createElement("p",null,"Settings"),r.a.createElement(j.a.Group,null,r.a.createElement(j.a.Label,null,"Color"),r.a.createElement(j.a.Control,{value:c,onChange:function(e){return a(e.target.value)},as:"select"},r.a.createElement("option",null,"JustGrey"),r.a.createElement("option",null,"Turbo"),r.a.createElement("option",null,"Rainbow"),r.a.createElement("option",null,"Spectral"),r.a.createElement("option",null,"Viridis"),r.a.createElement("option",null,"RdYlBu")),r.a.createElement("br",null),r.a.createElement(h.a,{onClick:function(){return C()(function(e){var t="http://www.w3.org/2000/xmlns/";e=e.cloneNode(!0);for(var a="".concat(window.location.href,"#"),n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1);n.nextNode();){var r,c=Object(x.a)(n.currentNode.attributes);try{for(c.s();!(r=c.n()).done;){var o=r.value;o.value.includes(a)&&(o.value=o.value.replace(a,"#"))}}catch(i){c.e(i)}finally{c.f()}}e.setAttributeNS(t,"xmlns","http://www.w3.org/2000/svg"),e.setAttributeNS(t,"xmlns:xlink","http://www.w3.org/1999/xlink");var l=(new window.XMLSerializer).serializeToString(e);return new Blob([l],{type:"image/svg+xml"})}(t.current))}},"Export SVG"),r.a.createElement(j.a.Group,{onChange:function(e){n(e.target.checked)}},r.a.createElement(j.a.Check,{type:"checkbox",label:"Draw paths"}))))})),H=a(83),B=a(59),M=a(87),G=a(88),N=a(86);function L(e){var t=e.onHide,a=e.settings,c=e.onSettings,o=Object(n.useState)(a.numSteps),l=Object(s.a)(o,2),i=l[0],u=l[1],d=Object(n.useState)(a.chunkSize),f=Object(s.a)(d,2),p=f[0],b=f[1],E=Object(n.useState)(a.strength),v=Object(s.a)(E,2),k=v[0],w=v[1],O=Object(n.useState)(a.sequenceThickness),y=Object(s.a)(O,2),x=y[0],S=y[1],C=Object(n.useState)(a.linkThickness),T=Object(s.a)(C,2),M=T[0],G=T[1];return r.a.createElement(m.a,{show:!0,onHide:t,size:"lg"},r.a.createElement(m.a.Header,{closeButton:!0},r.a.createElement(m.a.Title,null,"Settings")),r.a.createElement(m.a.Body,null,r.a.createElement(j.a,{onSubmit:function(e){e.preventDefault(),c(Object(g.a)({},a,{chunkSize:p,numSteps:i,strength:k,sequenceThickness:x,linkThickness:M})),t()}},r.a.createElement(j.a.Group,{as:H.a},r.a.createElement(j.a.Label,{column:!0,sm:"4"},"Number of simulation steps",r.a.createElement(j.a.Text,{muted:!0},"Used in the force-based layout simulation")),r.a.createElement(B.a,null,r.a.createElement(j.a.Control,{column:!0,type:"number",value:i,onChange:function(e){return u(+e.target.value)}}))),r.a.createElement(j.a.Group,{as:H.a},r.a.createElement(j.a.Label,{column:!0,sm:"4"},"Sequence chunk size",r.a.createElement(j.a.Text,{muted:!0},"If a contig is of length 5000, then chunk length 1000 would become 5 segments. Note that contigs smaller than the chunk length may not be proportionally sized")),r.a.createElement(B.a,null,r.a.createElement(j.a.Control,{column:!0,type:"number",value:p,onChange:function(e){return b(+e.target.value)}}))),r.a.createElement(j.a.Group,{as:H.a},r.a.createElement(j.a.Label,{column:!0,sm:"4"},"Force directed layout strength",r.a.createElement(j.a.Text,{muted:!0},"Used in the force-based layout simulation, larger values have more repulsion")),r.a.createElement(B.a,null,r.a.createElement(j.a.Control,{column:!0,type:"number",value:k,onChange:function(e){return w(+e.target.value)}}))),r.a.createElement(j.a.Group,{as:H.a},r.a.createElement(j.a.Label,{column:!0,sm:"4"},"Sequence thickness"),r.a.createElement(B.a,null,r.a.createElement(j.a.Control,{column:!0,type:"number",value:x,onChange:function(e){return S(+e.target.value)}}))),r.a.createElement(j.a.Group,{as:H.a},r.a.createElement(j.a.Label,{column:!0,sm:"4"},"Link thickness"),r.a.createElement(B.a,null,r.a.createElement(j.a.Control,{column:!0,type:"input",value:M,onChange:function(e){return G(+e.target.value)}}))),r.a.createElement(h.a,{type:"submit"},"Submit"))))}function q(e){var t=e.onHide;return r.a.createElement(m.a,{show:!0,onHide:t},r.a.createElement(m.a.Header,{closeButton:!0},r.a.createElement(m.a.Title,null,"graphgenome browser")),r.a.createElement(m.a.Body,null,r.a.createElement("p",null,"This is a small demo of browsing a simple graph genomes. The samples are provided via GFA format"),r.a.createElement("p",null,"Contact ",r.a.createElement("a",{href:"mainto:colin.diesh@gmail.com"},"Colin Diesh")),r.a.createElement("p",null,"Thanks to the BCC2020 pangenome team, and"," ",r.a.createElement("a",{href:"https://github.com/rrwick/Bandage"},"Bandage")," for inspiration."),r.a.createElement("p",null,"Sample data from GFA-spec repo (MT.gfa), Andrea Guarracino (path example), and gfalint (Shaun Jackman)"),r.a.createElement("a",{href:"https://github.com/cmdcolin/graphgenomeviewer"},"GitHub")))}function W(e){var t=e.onHide,a=e.onData,c=Object(n.useState)(),o=Object(s.a)(c,2),l=o[0],i=o[1];return r.a.createElement(m.a,{show:!0,onHide:t},r.a.createElement(m.a.Header,{closeButton:!0},r.a.createElement(m.a.Title,null,"graphgenome browser")),r.a.createElement(m.a.Body,null,r.a.createElement(j.a,{onSubmit:function(){a(l),t()}},r.a.createElement(j.a.Group,null,r.a.createElement(j.a.Label,null,"Enter URL"),r.a.createElement(j.a.Control,{type:"input",value:l,onChange:function(e){return i(e.target.value)}})),r.a.createElement(h.a,{type:"submit"},"Submit"))))}function F(e){var t=e.onHide,a=e.onGraph,c=Object(n.useRef)();return r.a.createElement(m.a,{show:!0,onHide:t},r.a.createElement(m.a.Header,{closeButton:!0},r.a.createElement(m.a.Title,null,"Open file")),r.a.createElement(m.a.Body,null,r.a.createElement(j.a,{onSubmit:function(){var e=Object(u.a)(i.a.mark((function e(n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,c.current.files[0].text();case 3:r=e.sent,a(r),t();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},r.a.createElement(j.a.Group,null,r.a.createElement(j.a.Label,null,"Open file"),r.a.createElement(j.a.Control,{ref:c,type:"file"})),r.a.createElement(h.a,{type:"submit"},"Submit"))))}function z(e){var t=e.onData,a=e.settings,c=e.onGraph,o=e.onSettings,l=Object(n.useState)(),i=Object(s.a)(l,2),u=i[0],m=i[1],h=Object(n.useState)(),d=Object(s.a)(h,2),f=d[0],g=d[1],p=Object(n.useState)(),b=Object(s.a)(p,2),E=b[0],v=b[1],k=Object(n.useState)(),w=Object(s.a)(k,2),O=w[0],j=w[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(M.a,{bg:"light",expand:"lg"},r.a.createElement(M.a.Brand,{href:"#home"},"graphgenome browser"),r.a.createElement(M.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(M.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(G.a,{className:"mr-auto"},r.a.createElement(N.a,{title:"File",id:"basic-nav-dropdown"},r.a.createElement(N.a.Item,{onClick:function(){return v(!0)}},"Open URL"),r.a.createElement(N.a.Item,{onClick:function(){return j(!0)}},"Open file")),r.a.createElement(N.a,{title:"Examples",id:"basic-nav-dropdown"},r.a.createElement(N.a.Item,{onClick:function(){return t("MT.gfa")}},"MT GFA-spec example"),r.a.createElement(N.a.Item,{onClick:function(){return t("toy_pangenome.gfa")}},"Paths example"),r.a.createElement(N.a.Item,{onClick:function(){return t("big1.gfa")}},"Big1"),r.a.createElement(N.a.Item,{onClick:function(){return t("ir1.gfa")}},"Ir1")),r.a.createElement(G.a.Link,{onClick:function(){g(!0)}},"Settings"),r.a.createElement(G.a.Link,{onClick:function(){m(!0)}},"About")))),u?r.a.createElement(q,{onHide:function(){return m(!1)}}):null,f?r.a.createElement(L,{settings:a,onHide:function(){return g(!1)},onSettings:o}):null,E?r.a.createElement(W,{onData:t,onHide:function(){return v(!1)}}):null,O?r.a.createElement(F,{onGraph:c,onHide:function(){return j(!1)}}):null)}a(76),a(77);var R=function(){var e=Object(n.useState)(),t=Object(s.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)("MT.gfa"),l=Object(s.a)(o,2),m=l[0],h=l[1],f=Object(n.useState)(),g=Object(s.a)(f,2),p=g[0],b=g[1],E=Object(n.useState)(),v=Object(s.a)(E,2),k=v[0],w=v[1],j=Object(n.useState)("Rainbow"),S=Object(s.a)(j,2),C=S[0],H=S[1],B=Object(n.useState)(!1),M=Object(s.a)(B,2),G=M[0],N=M[1],L=Object(n.useState)({strength:-50,chunkSize:1e3,numSteps:1e3,sequenceThickness:10,linkThickness:2}),q=Object(s.a)(L,2),W=q[0],F=q[1],R=Object(n.useRef)();Object(n.useEffect)((function(){Object(u.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(m);case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("Failed to fetch ".concat(t.statusText));case 6:return e.next=8,t.text();case 8:a=e.sent,b(a),w(void 0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0),w(e.t0.message);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))()}),[m]);var D=Object(n.useMemo)((function(){return p?function(e){var t,a={nodes:[],links:[],paths:[]},n=Object(x.a)(e.split("\n"));try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.startsWith("S")){for(var c=r.split("\t"),o=Object(y.a)(c),l=o[1],i=o[2],u=o.slice(3),m={},h=0;h<u.length;h++){var d=u[h].split(":"),f=Object(s.a)(d,3),g=f[0],p=f[1],b=f[2];"i"===p?m[g]=+b:"Z"===p&&(m[g]=b)}a.nodes.push({id:l,sequence:i,tags:m})}else if(r.startsWith("L")){for(var E=r.split("\t"),v=Object(y.a)(E),k=v[1],w=v[2],O=v[3],j=v[4],S=v[5],C=v.slice(6),T={},H=0;H<C.length;H++){var B=C[H].split(":"),M=Object(s.a)(B,3),G=M[0],N=M[1],L=M[2];"i"===N?T[G]=+L:"Z"===N&&(T[G]=L)}a.links.push({source:k,target:O,strand1:w,strand2:j,cigar:S,tags:T})}else if(r.startsWith("P")){var q=r.split("\t"),W=Object(y.a)(q),F=W[1],z=W[2],R=W.slice(3);a.paths.push({name:F,path:z,rest:R})}}}catch(D){n.e(D)}finally{n.f()}return a}(p):void 0}),[p]);return r.a.createElement("div",null,r.a.createElement(z,{onData:function(e){h(e)},onGraph:function(e){b(e)},onSettings:function(e){F(e)},settings:W}),a?r.a.createElement(d,{data:a,onModal:function(e){c(e)},onHide:function(){c(void 0)}}):null,r.a.createElement("div",{className:"flexcontainer"},r.a.createElement("div",{id:"sidebar",className:"sidebar"},r.a.createElement(T,{ref:R,color:C,onColorChange:function(e){return H(e)},onPathDraw:function(e){return N(e)}})),r.a.createElement("div",{className:"body"},k?r.a.createElement("div",{style:{color:"red"}},k):null,D?r.a.createElement(O,{graph:D,ref:R,color:C,drawPaths:G,onFeatureClick:function(e){c(e)},settings:W}):null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(R,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[64,1,2]]]);
//# sourceMappingURL=main.a6c90776.chunk.js.map