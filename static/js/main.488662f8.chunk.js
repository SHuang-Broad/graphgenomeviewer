(this.webpackJsonpgenomegraph=this.webpackJsonpgenomegraph||[]).push([[0],{63:function(e,t,a){e.exports=a(77)},68:function(e,t,a){},76:function(e,t,a){},77:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(18),c=a.n(o),l=(a(68),a(24)),i=a.n(l),s=a(55),u=a(9),m=a(82),d=a(57);function h(e){var t=e.data,a=e.onHide;return r.a.createElement(m.a,{show:!0,onHide:a},r.a.createElement(m.a.Header,{closeButton:!0},r.a.createElement(m.a.Title,null,"Feature details")),r.a.createElement(m.a.Body,null,r.a.createElement("div",null,"Attributes"),Object.entries(t).filter((function(e){return!["source","target","linkNum","tags"].includes(e[0])})).map((function(e){var t=Object(u.a)(e,2),a=t[0],n=t[1];return r.a.createElement("div",{key:"".concat(a,"_").concat(n),style:{display:"flex",maxHeight:150,margin:3}},r.a.createElement("div",{style:{backgroundColor:"#dda",minWidth:100}},a),r.a.createElement("div",{style:{wordBreak:"break-word",overflow:"auto"}},String(n)))})),r.a.createElement("hr",null),t.tags&&Object.keys(t.tags).length?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,"Tags"),Object.entries(t.tags).map((function(e){var t=Object(u.a)(e,2),a=t[0],n=t[1];return r.a.createElement("div",{key:"".concat(a,"_").concat(n),style:{display:"flex",maxHeight:150,margin:3}},r.a.createElement("div",{style:{backgroundColor:"#dda",minWidth:100}},a),r.a.createElement("div",{style:{wordBreak:"break-word",overflow:"auto"}},String(n)))}))):null,r.a.createElement(m.a.Footer,null,r.a.createElement(d.a,{variant:"secondary",onClick:a},"Close"))))}var f=a(53),g=a(32),p=a(51),v=a(10),k=i.a.mark(E),b=i.a.mark(w);function E(e,t){var a,n,r,o,c;return i.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:a=e[0].linkNum,n=[],o=0;case 3:if(!(o<e.length)){l.next=17;break}if(c=e[o],a===c.linkNum){l.next=11;break}if(!r.id){l.next=9;break}return l.next=9,{links:n,original:r};case 9:n=[],a=c.linkNum;case 11:r=t[o],n.push([c.source.x,c.source.y]),n.push([c.target.x,c.target.y]);case 14:o++,l.next=3;break;case 17:case"end":return l.stop()}}),k)}function w(e,t){var a,n,r;return i.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:a=0;case 1:if(!(a<e.length)){o.next=10;break}if(n=e[a],(r=t[a]).id){o.next=7;break}return o.next=7,{links:[[n.source.x,n.source.y],[n.target.x,n.target.y]],original:r};case 7:a++,o.next=1;break;case 10:case"end":return o.stop()}}),b)}var x=r.a.forwardRef((function(e,t){var a=Object(n.useRef)(),o=e.graph,c=(e.path,e.drawPaths),l=void 0!==c&&c,i=e.blockSize,s=void 0===i?1e3:i,u=e.contigThickness,m=void 0===u?10:u,d=e.edgeThickness,h=void 0===d?2:d,k=e.color,b=void 0===k?"Rainbow":k,x=e.width,O=void 0===x?2e3:x,j=e.height,y=void 0===j?1e3:j,C=e.steps,S=void 0===C?500:C,M=e.onFeatureClick,T=void 0===M?function(){console.log("no feature click configured")}:M,N=Object(n.useMemo)((function(){return function(e,t){for(var a={nodes:[],links:[]},n={},r=0;r<(e.paths||{}).length;r++)for(var o=e.paths[r],c=o.path.split(","),l=0;l<c.length-1;l++){var i="".concat(c[l],"_").concat(c[l+1]);n[i]?n[i].push(o.name):n[i]=[o.name]}for(var s=0;s<e.nodes.length;s++){var u=e.nodes[s],m=u.id,d=u.sequence,h=Object(p.a)(u,["id","sequence"]),f=[];f.push(Object(g.a)({},h,{id:"".concat(m,"-start")}));for(var v=t;v<d.length-t;v+=t)f.push(Object(g.a)({},h,{id:"".concat(m,"-").concat(v)}));f.push(Object(g.a)({},h,{id:"".concat(m,"-end")}));for(var k=0;k<f.length-1;k++){var b=f[k].id,E=f[k+1].id;a.links.push(Object(g.a)({},h,{source:b,target:E,id:m,linkNum:s,length:d.length,sequence:d}))}a.nodes=a.nodes.concat(f)}for(var w=0;w<e.links.length;w++){var x=e.links[w],O=x.strand1,j=x.strand2,y=x.source,C=x.target,S=Object(p.a)(x,["strand1","strand2","source","target"]),M=n["".concat(y).concat(O,"_").concat(C).concat(j)]||[],T=y===C,N=Object(g.a)({source:"".concat(y,"-").concat("+"===O?"end":"start"),target:"".concat(C,"-").concat("+"===j?"start":"end")},S);T&&(N.loop=!0),M.length&&(N.paths=M),a.links.push(N)}return a}(o,s)}),[s,o]),B=Object(n.useMemo)((function(){var e={};return(o.paths||[]).forEach((function(t,a){e[t.name]=v.schemeCategory10[a]})),e}),[o.paths]),W=Object(n.useMemo)((function(){for(var e=N.links.map((function(e){return Object.create(e)})),t=N.nodes.map((function(e){return Object.create(e)})),a=0,n=0;n<N.links.length;n++)a=Math.max(a,(N.links[n].sequence||{}).length||0);for(var r=v.forceSimulation(t).force("link",v.forceLink(e).id((function(e){return e.id})).distance((function(e){return e.sequence?1:10}))).force("charge",v.forceManyBody().strength(-100)).force("center",v.forceCenter(O/2,y/2)),o=0;o<S;++o)r.tick();return e}),[N,y,S,O]);Object(n.useEffect)((function(){v.select(t.current).call(v.zoom().extent([[0,0],[O,y]]).scaleExtent([.1,8]).on("zoom",(function(){v.select(a.current).attr("transform",v.event.transform)})))}),[y,t,O]);var H=Object(f.a)(E(W,N.links)),F=Object(f.a)(w(W,N.links)),q={};return H.forEach((function(e){var t=e.original,a=t.source,n=t.target,r=t.linkNum;a.endsWith("start")?(q[a]={source:W[r].target,target:W[r].source},q[n]={target:W[r].target,source:W[r].source}):(q[a]={source:W[r].source,target:W[r].target},q[n]={target:W[r].source,source:W[r].target})})),l&&!F[0].original.paths?r.a.createElement("h1",null,"no paths found"):r.a.createElement("svg",{width:"100%",height:"100%",ref:t,viewBox:[0,0,O,y].toString()},r.a.createElement("g",{ref:a},F.map((function(e){var t=e.links[0][0],a=e.links[0][1],n=e.links[1][0],o=e.links[1][1];if(l){var c=q[e.original.source],i=c.source,s=c.target,u=q[e.original.target],m=u.source,d=u.target,f=Math.sqrt(Math.pow(s.y-i.y,2)+Math.pow(s.x-i.x,2)),g=Math.sqrt(Math.pow(d.y-m.y,2)+Math.pow(d.x-m.x,2));return e.original.paths.map((function(c,l){var u=(60+50*l)/f,p=(60+50*l)/g,k=(1-u)*i.x+u*s.x,b=(1-u)*i.y+u*s.y,E=(1-p)*m.x+p*d.x,w=(1-p)*m.y+p*d.y,x=v.path();return x.moveTo(t,a),x.bezierCurveTo(k,b,E,w,n,o),r.a.createElement("path",{key:x.toString(),d:x,strokeWidth:h,stroke:B[c],fill:"none",onClick:function(){return T(e.original)}})}))}var p,k=v.line().context(null),b=e.links[0][0],E=e.links[0][1],w=e.links[1][0],x=e.links[1][1],O=w-b,j=x-E,y=Math.sqrt(O*O+j*j),C=y,S=y,M=0,N=0;return e.original.loop?(M=90,N=1,C=-30,S=-20,w+=1,x+=1,p="M".concat(b,",").concat(E,"A").concat(C,",").concat(S," ").concat(M,",").concat(N,",").concat(0," ").concat(w,",").concat(x)):p=k(e.links),r.a.createElement("path",{key:p.toString(),d:p,strokeWidth:h,stroke:"black",fill:"none",onClick:function(){return T(e.original)}})})),H.map((function(e,t){var a=v.line().context(null)(e.links);return r.a.createElement("path",{key:a.toString(),d:a,title:e.id,strokeWidth:m,stroke:b.startsWith("Just")?b.replace("Just","").toLowerCase():v.hsl(v["interpolate".concat(b)](t/H.length)).darker(),fill:"none",onClick:function(){return T(e.original)}},r.a.createElement("title",null,e.id))}))))})),O=a(83),j=a(49),y=a(52);function C(e){var t,a={nodes:[],links:[],paths:[]},n=Object(y.a)(e.split("\n"));try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.startsWith("S")){for(var o=r.split("\t"),c=Object(j.a)(o),l=c[1],i=c[2],s=c.slice(3),m={},d=0;d<s.length;d++){var h=s[d].split(":"),f=Object(u.a)(h,3),g=f[0],p=f[1],v=f[2];"i"===p?m[g]=+v:"Z"===p&&(m[g]=v)}a.nodes.push({id:l,sequence:i,tags:m})}else if(r.startsWith("L")){for(var k=r.split("\t"),b=Object(j.a)(k),E=b[1],w=b[2],x=b[3],O=b[4],C=b[5],S=b.slice(6),M={},T=0;T<S.length;T++){var N=S[T].split(":"),B=Object(u.a)(N,3),W=B[0],H=B[1],F=B[2];"i"===H?M[W]=+F:"Z"===H&&(M[W]=F)}a.links.push({source:E,target:x,strand1:w,strand2:O,cigar:C,tags:M})}else if(r.startsWith("P")){var q=r.split("\t"),R=Object(j.a)(q),A=R[1],G=R[2],L=R.slice(3);a.paths.push({name:A,path:G,rest:L})}}}catch(z){n.e(z)}finally{n.f()}return a}var S=a(58),M=a.n(S),T=r.a.forwardRef((function(e,t){var a=e.onColorChange,n=e.onPathDraw,o=e.color;return r.a.createElement("div",null,r.a.createElement("p",null,"Settings"),r.a.createElement(O.a.Group,null,r.a.createElement(O.a.Label,null,"Color"),r.a.createElement(O.a.Control,{value:o,onChange:function(e){return a(e.target.value)},as:"select"},r.a.createElement("option",null,"JustGrey"),r.a.createElement("option",null,"Turbo"),r.a.createElement("option",null,"Rainbow"),r.a.createElement("option",null,"Spectral"),r.a.createElement("option",null,"Viridis"),r.a.createElement("option",null,"RdYlBu")),r.a.createElement("br",null),r.a.createElement(d.a,{onClick:function(){return M()(function(e){var t="http://www.w3.org/2000/xmlns/";e=e.cloneNode(!0);for(var a="".concat(window.location.href,"#"),n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1);n.nextNode();){var r,o=Object(y.a)(n.currentNode.attributes);try{for(o.s();!(r=o.n()).done;){var c=r.value;c.value.includes(a)&&(c.value=c.value.replace(a,"#"))}}catch(i){o.e(i)}finally{o.f()}}e.setAttributeNS(t,"xmlns","http://www.w3.org/2000/svg"),e.setAttributeNS(t,"xmlns:xlink","http://www.w3.org/1999/xlink");var l=(new window.XMLSerializer).serializeToString(e);return new Blob([l],{type:"image/svg+xml"})}(t.current))}},"Export SVG"),r.a.createElement(O.a.Group,{onChange:function(e){n(e.target.checked)}},r.a.createElement(O.a.Check,{type:"checkbox",label:"Draw paths"}))))})),N=a(85),B=a(86),W=a(84);function H(e){var t=e.onHide;return r.a.createElement(m.a,{show:!0,onHide:t},r.a.createElement(m.a.Header,{closeButton:!0},r.a.createElement(m.a.Title,null,"graphgenome browser")),r.a.createElement(m.a.Body,null,r.a.createElement("p",null,"This is a small demo of browsing a simple graph genomes. The samples are provided via GFA format"),r.a.createElement("p",null,"Contact ",r.a.createElement("a",{href:"mainto:colin.diesh@gmail.com"},"Colin Diesh")),r.a.createElement("p",null,"Thanks to the BCC2020 pangenome team, and"," ",r.a.createElement("a",{href:"https://github.com/rrwick/Bandage"},"Bandage")," for inspiration"),r.a.createElement("a",{href:"https://github.com/cmdcolin/graphgenomeviewer"},"GitHub")))}function F(e){var t=e.onData,a=Object(n.useState)(),o=Object(u.a)(a,2),c=o[0],l=o[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{bg:"light",expand:"lg"},r.a.createElement(N.a.Brand,{href:"#home"},"graphgenome browser"),r.a.createElement(N.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(N.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(B.a,{className:"mr-auto"},r.a.createElement(W.a,{title:"Examples",id:"basic-nav-dropdown"},r.a.createElement(W.a.Item,{onClick:function(){return t("MT.gfa")}},"MT GFA-spec example"),r.a.createElement(W.a.Item,{onClick:function(){return t("toy_pangenome.gfa")}},"Paths example")),r.a.createElement(B.a.Link,{onClick:function(){l(!0)}},"About")))),c?r.a.createElement(H,{onHide:function(){return l(!1)}}):null)}a(75),a(76);var q=function(){var e=Object(n.useState)(),t=Object(u.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)("MT.gfa"),l=Object(u.a)(c,2),m=l[0],d=l[1],f=Object(n.useState)(),g=Object(u.a)(f,2),p=g[0],v=g[1],k=Object(n.useState)(),b=Object(u.a)(k,2),E=b[0],w=b[1],O=Object(n.useState)("Rainbow"),j=Object(u.a)(O,2),y=j[0],S=j[1],M=Object(n.useState)(!1),N=Object(u.a)(M,2),B=N[0],W=N[1],H=Object(n.useRef)();return Object(n.useEffect)((function(){Object(s.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(m);case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("Failed to fetch ".concat(t.statusText));case 6:return e.next=8,t.text();case 8:a=e.sent,n=C(a),v(n),w(void 0),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error(e.t0),w(e.t0.message);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))()}),[m]),r.a.createElement("div",null,r.a.createElement(F,{onData:function(e){d(e)}}),a?r.a.createElement(h,{data:a,onModal:function(e){o(e)},onHide:function(){o(void 0)}}):null,r.a.createElement("div",{className:"flexcontainer"},r.a.createElement("div",{id:"sidebar",className:"sidebar"},r.a.createElement(T,{ref:H,color:y,onColorChange:function(e){return S(e)},onPathDraw:function(e){return W(e)}})),r.a.createElement("div",{className:"body"},E?r.a.createElement("div",{style:{color:"red"}},E):null,p?r.a.createElement(x,{graph:p,ref:H,color:y,drawPaths:B,onFeatureClick:function(e){o(e)}}):null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[63,1,2]]]);
//# sourceMappingURL=main.488662f8.chunk.js.map